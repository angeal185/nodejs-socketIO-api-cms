<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="app/css/bootstrap.min.css">
    <link rel="stylesheet" href="app/css/styles.css">
  </head>
  <body>

  <script>

    var editor = ace.edit("editor");
    var MD = ace.edit("MD");

    editor.setTheme("ace/theme/twilight");
    editor.getSession();
    editor.session.setMode("ace/mode/markdown");

    MD.setTheme("ace/theme/twilight");
    MD.getSession();
    MD.session.setMode("ace/mode/html");

  //editor.setOptions(aceConf);
editor.commands.addCommand({
  name: "showKeyboardShortcuts",
  bindKey: {win: "Ctrl-Alt-h", mac: "Command-Alt-h"},
  exec: function(editor) {
      ace.config.loadModule("ace/ext/keybinding_menu", function(module) {
          module.init(editor);
          editor.showKeyboardShortcuts()
        })
    }
});
editor.commands.addCommand({
  name: "showSettingsMenu",
  bindKey: {win: "Ctrl-q", mac: "Command-q"},
  exec: function(editor) {
      ace.config.loadModule("ace/ext/settings_menu", function(module) {
          module.init(editor);
          editor.showSettingsMenu()
        })
    }
});
MD.commands.addCommand({
  name: "showKeyboardShortcuts2",
  bindKey: {win: "Ctrl-Alt-i", mac: "Command-Alt-i"},
  exec: function(MD) {
      ace.config.loadModule("ace/ext/keybinding_menu", function(module) {
          module.init(editor);
          MD.showKeyboardShortcuts()
        })
    }
});
MD.commands.addCommand({
  name: "showSettingsMenu2",
  bindKey: {win: "Ctrl-r", mac: "Command-r"},
  exec: function(MD) {
      ace.config.loadModule("ace/ext/settings_menu", function(module) {
          module.init(editor);
          MD.showSettingsMenu()
          $('select').each(function(index, el) {
            $(this).addClass('custom-select');
          });
          $('.fadeIt').click(function() {
            $(this).fadeOut('slow');
          });
        })
    }
});

$('#editorSettings').click(function(event) {
  editor.execCommand("showSettingsMenu")
});

$('#MDSettings').click(function(event) {
  MD.execCommand("showSettingsMenu2")
});

$('#button').click(function() {
console.log(editor.getValue())
});
$('#commit').click(function() {
 console.log(MD.getValue().replace(/ /g,""))
});

$('select').each(function(index, el) {
  $(this).addClass('custom-select');
});

function rpl(i){
  i.replace('<p><div','<div').replace('</p></div>','</div>');
}

function mdSet(){
  var out = _.unescape(markdown.toHTML(editor.getValue()));
  MD.setValue(out);
}
function mdUpdate(){
  editor.setValue(toMarkdown(MD.getValue()))
}
function previewUpdate(){
  $('#previewDiv').html(MD.getValue());
}

editor.on("change", _.debounce(mdSet, 1000));

MD.on("change", _.debounce(previewUpdate, 500));

$('#updateMD').click(function() {
  mdUpdate();
});


  </script>
  </body>
</html>
