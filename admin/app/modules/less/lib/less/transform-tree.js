var contexts=require("./contexts"),visitor=require("./visitors"),tree=require("./tree");module.exports=function(e,r){r=r||{};var i,t=r.variables,s=new contexts.Eval(r);"object"!=typeof t||Array.isArray(t)||(t=Object.keys(t).map(function(e){var r=t[e];return r instanceof tree.Value||(r instanceof tree.Expression||(r=new tree.Expression([r])),r=new tree.Value([r])),new tree.Rule("@"+e,r,!1,null,0)}),s.frames=[new tree.Ruleset(null,t)]);var n,o=[],a=[new visitor.JoinSelectorVisitor,new visitor.MarkVisibleSelectorsVisitor(!0),new visitor.ExtendVisitor,new visitor.ToCSSVisitor({compress:Boolean(r.compress)})];if(r.pluginManager){var l=r.pluginManager.getVisitors();for(n=0;n<l.length;n++){var u=l[n];u.isPreEvalVisitor?o.push(u):u.isPreVisitor?a.splice(0,0,u):a.push(u)}}for(n=0;n<o.length;n++)o[n].run(e);for(i=e.eval(s),n=0;n<a.length;n++)a[n].run(i);return i};
