function colorBlend(n,o,r){var e,t,l,u,c=o.alpha,i=r.alpha,d=[];l=i+c*(1-i);for(var a=0;a<3;a++)e=o.rgb[a]/255,t=r.rgb[a]/255,u=n(e,t),l&&(u=(i*t+c*(e-i*(e+t-u)))/l),d[a]=255*u;return new Color(d,l)}var Color=require("../tree/color"),functionRegistry=require("./function-registry"),colorBlendModeFunctions={multiply:function(n,o){return n*o},screen:function(n,o){return n+o-n*o},overlay:function(n,o){return n*=2,n<=1?colorBlendModeFunctions.multiply(n,o):colorBlendModeFunctions.screen(n-1,o)},softlight:function(n,o){var r=1,e=n;return o>.5&&(e=1,r=n>.25?Math.sqrt(n):((16*n-12)*n+4)*n),n-(1-2*o)*e*(r-n)},hardlight:function(n,o){return colorBlendModeFunctions.overlay(o,n)},difference:function(n,o){return Math.abs(n-o)},exclusion:function(n,o){return n+o-2*n*o},average:function(n,o){return(n+o)/2},negation:function(n,o){return 1-Math.abs(n+o-1)}};for(var f in colorBlendModeFunctions)colorBlendModeFunctions.hasOwnProperty(f)&&(colorBlend[f]=colorBlend.bind(null,colorBlendModeFunctions[f]));functionRegistry.addMultiple(colorBlend);
