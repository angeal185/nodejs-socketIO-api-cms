function _noop(e){return e}function indexNodeTypes(e,t){var i,n;for(i in e)if(e.hasOwnProperty(i))switch(typeof(n=e[i])){case"function":n.prototype&&n.prototype.type&&(n.prototype.typeIndex=t++);break;case"object":t=indexNodeTypes(n,t)}return t}var tree=require("../tree"),_visitArgs={visitDeeper:!0},_hasIndexed=!1,Visitor=function(e){this._implementation=e,this._visitFnCache=[],_hasIndexed||(indexNodeTypes(tree,1),_hasIndexed=!0)};Visitor.prototype={visit:function(e){if(!e)return e;var t=e.typeIndex;if(!t)return e;var i,n=this._visitFnCache,r=this._implementation,o=t<<1,s=1|o,p=n[o],a=n[s],h=_visitArgs;if(h.visitDeeper=!0,p||(i="visit"+e.type,p=r[i]||_noop,a=r[i+"Out"]||_noop,n[o]=p,n[s]=a),p!==_noop){var c=p.call(r,e,h);r.isReplacing&&(e=c)}return h.visitDeeper&&e&&e.accept&&e.accept(this),a!=_noop&&a.call(r,e),e},visitArray:function(e,t){if(!e)return e;var i,n=e.length;if(t||!this._implementation.isReplacing){for(i=0;i<n;i++)this.visit(e[i]);return e}var r=[];for(i=0;i<n;i++){var o=this.visit(e[i]);void 0!==o&&(o.splice?o.length&&this.flatten(o,r):r.push(o))}return r},flatten:function(e,t){t||(t=[]);var i,n,r,o,s,p;for(n=0,i=e.length;n<i;n++)if(void 0!==(r=e[n]))if(r.splice)for(s=0,o=r.length;s<o;s++)void 0!==(p=r[s])&&(p.splice?p.length&&this.flatten(p,t):t.push(p));else t.push(r);return t}},module.exports=Visitor;
