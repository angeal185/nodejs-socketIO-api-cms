var chunker=require("./chunker");module.exports=function(){function r(i){for(var n,a,m,v=h.i,p=e,A=h.i-o,b=h.i+c.length-A,x=h.i+=i,C=t;h.i<b;h.i++){if(n=C.charCodeAt(h.i),h.autoCommentAbsorb&&n===g){if("/"===(a=C.charAt(h.i+1))){m={index:h.i,isLineComment:!0};var k=C.indexOf("\n",h.i+2);k<0&&(k=b),h.i=k,m.text=C.substr(m.index,h.i-m.index),h.commentStore.push(m);continue}if("*"===a){var $=C.indexOf("*/",h.i+2);if($>=0){m={index:h.i,text:C.substr(h.i,$+2-h.i),isLineComment:!1},h.i+=m.text.length-1,h.commentStore.push(m);continue}}break}if(n!==f&&n!==l&&n!==s&&n!==d)break}if(c=c.slice(i+h.i-x+A),o=h.i,!c.length){if(e<u.length-1)return c=u[++e],r(0),!0;h.finished=!0}return v!==h.i||p!==e}var t,e,i,n,u,c,o,a=[],h={},f=32,s=9,l=10,d=13,g=47;return h.save=function(){o=h.i,a.push({current:c,i:h.i,j:e})},h.restore=function(r){(h.i>i||h.i===i&&r&&!n)&&(i=h.i,n=r);var t=a.pop();c=t.current,o=h.i=t.i,e=t.j},h.forget=function(){a.pop()},h.isWhitespace=function(r){var e=h.i+(r||0),i=t.charCodeAt(e);return i===f||i===d||i===s||i===l},h.$re=function(t){h.i>o&&(c=c.slice(h.i-o),o=h.i);var e=t.exec(c);return e?(r(e[0].length),"string"==typeof e?e:1===e.length?e[0]:e):null},h.$char=function(e){return t.charAt(h.i)!==e?null:(r(1),e)},h.$str=function(e){for(var i=e.length,n=0;n<i;n++)if(t.charAt(h.i+n)!==e.charAt(n))return null;return r(i),e},h.$quoted=function(){var e=t.charAt(h.i);if("'"===e||'"'===e){for(var i=t.length,n=h.i,u=1;u+n<i;u++){switch(t.charAt(u+n)){case"\\":u++;continue;case"\r":case"\n":break;case e:var c=t.substr(n,u+1);return r(u+1),c}}return null}},h.autoCommentAbsorb=!0,h.commentStore=[],h.finished=!1,h.peek=function(r){if("string"==typeof r){for(var e=0;e<r.length;e++)if(t.charAt(h.i+e)!==r.charAt(e))return!1;return!0}return r.test(c)},h.peekChar=function(r){return t.charAt(h.i)===r},h.currentChar=function(){return t.charAt(h.i)},h.getInput=function(){return t},h.peekNotNumeric=function(){var r=t.charCodeAt(h.i);return r>57||r<43||r===g||44===r},h.start=function(n,a,f){t=n,h.i=e=o=i=0,u=a?chunker(n,f):[n],c=u[0],r(0)},h.end=function(){var r,e=h.i>=t.length;return h.i<i&&(r=n,h.i=i),{isFinished:e,furthest:h.i,furthestPossibleErrorMessage:r,furthestReachedEnd:h.i>=t.length-1,furthestChar:t[h.i]}},h};
