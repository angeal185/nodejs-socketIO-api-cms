var Node=require("./node"),Selector=require("./selector"),Ruleset=require("./ruleset"),Directive=function(e,t,i,r,s,o,l,u){var n;if(this.name=e,this.value=t,i)for(Array.isArray(i)?this.rules=i:(this.rules=[i],this.rules[0].selectors=new Selector([],null,null,this.index,s).createEmptySelectors()),n=0;n<this.rules.length;n++)this.rules[n].allowImports=!0;this.index=r,this.currentFileInfo=s,this.debugInfo=o,this.isRooted=l||!1,this.copyVisibilityInfo(u),this.allowRoot=!0};Directive.prototype=new Node,Directive.prototype.type="Directive",Directive.prototype.accept=function(e){var t=this.value,i=this.rules;i&&(this.rules=e.visitArray(i)),t&&(this.value=e.visit(t))},Directive.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},Directive.prototype.isCharset=function(){return"@charset"===this.name},Directive.prototype.genCSS=function(e,t){var i=this.value,r=this.rules;t.add(this.name,this.currentFileInfo,this.index),i&&(t.add(" "),i.genCSS(e,t)),r?this.outputRuleset(e,t,r):t.add(";")},Directive.prototype.eval=function(e){var t,i,r=this.value,s=this.rules;return t=e.mediaPath,i=e.mediaBlocks,e.mediaPath=[],e.mediaBlocks=[],r&&(r=r.eval(e)),s&&(s=[s[0].eval(e)],s[0].root=!0),e.mediaPath=t,e.mediaBlocks=i,new Directive(this.name,r,s,this.index,this.currentFileInfo,this.debugInfo,this.isRooted,this.visibilityInfo())},Directive.prototype.variable=function(e){if(this.rules)return Ruleset.prototype.variable.call(this.rules[0],e)},Directive.prototype.find=function(){if(this.rules)return Ruleset.prototype.find.apply(this.rules[0],arguments)},Directive.prototype.rulesets=function(){if(this.rules)return Ruleset.prototype.rulesets.apply(this.rules[0])},Directive.prototype.outputRuleset=function(e,t,i){var r,s=i.length;if(e.tabLevel=1+(0|e.tabLevel),e.compress){for(t.add("{"),r=0;r<s;r++)i[r].genCSS(e,t);return t.add("}"),void e.tabLevel--}var o="\n"+Array(e.tabLevel).join("  "),l=o+"  ";if(s){for(t.add(" {"+l),i[0].genCSS(e,t),r=1;r<s;r++)t.add(l),i[r].genCSS(e,t);t.add(o+"}")}else t.add(" {"+o+"}");e.tabLevel--},module.exports=Directive;
