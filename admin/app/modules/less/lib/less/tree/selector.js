var Node=require("./node"),Element=require("./element"),Selector=function(e,t,i,n,o,r){this.elements=e,this.extendList=t,this.condition=i,this.currentFileInfo=o||{},i||(this.evaldCondition=!0),this.copyVisibilityInfo(r)};Selector.prototype=new Node,Selector.prototype.type="Selector",Selector.prototype.accept=function(e){this.elements&&(this.elements=e.visitArray(this.elements)),this.extendList&&(this.extendList=e.visitArray(this.extendList)),this.condition&&(this.condition=e.visit(this.condition))},Selector.prototype.createDerived=function(e,t,i){var n=this.visibilityInfo();i=null!=i?i:this.evaldCondition;var o=new Selector(e,t||this.extendList,null,this.index,this.currentFileInfo,n);return o.evaldCondition=i,o.mediaEmpty=this.mediaEmpty,o},Selector.prototype.createEmptySelectors=function(){var e=new Element("","&",this.index,this.currentFileInfo),t=[new Selector([e],null,null,this.index,this.currentFileInfo)];return t[0].mediaEmpty=!0,t},Selector.prototype.match=function(e){var t,i,n=this.elements,o=n.length;if(e.CacheElements(),0===(t=e._elements.length)||o<t)return 0;for(i=0;i<t;i++)if(n[i].value!==e._elements[i])return 0;return t},Selector.prototype.CacheElements=function(){if(!this._elements){var e=this.elements.map(function(e){return e.combinator.value+(e.value.value||e.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);e?"&"===e[0]&&e.shift():e=[],this._elements=e}},Selector.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},Selector.prototype.eval=function(e){var t=this.condition&&this.condition.eval(e),i=this.elements,n=this.extendList;return i=i&&i.map(function(t){return t.eval(e)}),n=n&&n.map(function(t){return t.eval(e)}),this.createDerived(i,n,t)},Selector.prototype.genCSS=function(e,t){var i,n;if(e&&e.firstSelector||""!==this.elements[0].combinator.value||t.add(" ",this.currentFileInfo,this.index),!this._css)for(i=0;i<this.elements.length;i++)n=this.elements[i],n.genCSS(e,t)},Selector.prototype.getIsOutput=function(){return this.evaldCondition},module.exports=Selector;
