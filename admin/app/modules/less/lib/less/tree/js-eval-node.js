var Node=require("./node"),Variable=require("./variable"),JsEvalNode=function(){};JsEvalNode.prototype=new Node,JsEvalNode.prototype.evaluateJavaScript=function(e,a){var r,i=this,n={};if(void 0!==a.javascriptEnabled&&!a.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};e=e.replace(/@\{([\w-]+)\}/g,function(e,r){return i.jsify(new Variable("@"+r,i.index,i.currentFileInfo).eval(a))});try{e=new Function("return ("+e+")")}catch(a){throw{message:"JavaScript evaluation error: "+a.message+" from `"+e+"`",filename:this.currentFileInfo.filename,index:this.index}}var t=a.frames[0].variables();for(var o in t)t.hasOwnProperty(o)&&(n[o.slice(1)]={value:t[o].value,toJS:function(){return this.value.eval(a).toCSS()}});try{r=e.call(n)}catch(e){throw{message:"JavaScript evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return r},JsEvalNode.prototype.jsify=function(e){return Array.isArray(e.value)&&e.value.length>1?"["+e.value.map(function(e){return e.toCSS()}).join(", ")+"]":e.toCSS()},module.exports=JsEvalNode;
