function clamp(t){return Math.max(0,Math.min(t.toFixed(0),255))}function clampAlpha(t){return Math.max(0,Math.min(t,1))}var Node=require("./node"),HSLA=require("./hsla"),functions=require("../functions"),adjust=functions.adjust,nodes=require("./"),RGBA=exports=module.exports=function(t,e,n,r){Node.call(this),this.r=clamp(t),this.g=clamp(e),this.b=clamp(n),this.a=clampAlpha(r),this.name="",this.rgba=this};RGBA.prototype.__proto__=Node.prototype,RGBA.withoutClamping=function(t,e,n,r){var i=new RGBA(0,0,0,0);return i.r=t,i.g=e,i.b=n,i.a=r,i},RGBA.prototype.clone=function(){var t=new RGBA(this.r,this.g,this.b,this.a);return t.raw=this.raw,t.name=this.name,t.lineno=this.lineno,t.column=this.column,t.filename=this.filename,t},RGBA.prototype.toJSON=function(){return{__type:"RGBA",r:this.r,g:this.g,b:this.b,a:this.a,raw:this.raw,name:this.name,lineno:this.lineno,column:this.column,filename:this.filename}},RGBA.prototype.toBoolean=function(){return nodes.true},RGBA.prototype.__defineGetter__("hsla",function(){return HSLA.fromRGBA(this)}),RGBA.prototype.__defineGetter__("hash",function(){return this.toString()}),RGBA.prototype.add=function(t,e,n,r){return new RGBA(this.r+t,this.g+e,this.b+n,this.a+r)},RGBA.prototype.sub=function(t,e,n,r){return new RGBA(this.r-t,this.g-e,this.b-n,1==r?this.a:this.a-r)},RGBA.prototype.multiply=function(t){return new RGBA(this.r*t,this.g*t,this.b*t,this.a)},RGBA.prototype.divide=function(t){return new RGBA(this.r/t,this.g/t,this.b/t,this.a)},RGBA.prototype.operate=function(t,e){switch("in"!=t&&(e=e.first),t){case"is a":if("string"==e.nodeName&&"color"==e.string)return nodes.true;break;case"+":switch(e.nodeName){case"unit":var n=e.val;switch(e.type){case"%":return adjust(this,new nodes.String("lightness"),e);case"deg":return this.hsla.adjustHue(n).rgba;default:return this.add(n,n,n,0)}case"rgba":return this.add(e.r,e.g,e.b,e.a);case"hsla":return this.hsla.add(e.h,e.s,e.l)}break;case"-":switch(e.nodeName){case"unit":var n=e.val;switch(e.type){case"%":return adjust(this,new nodes.String("lightness"),new nodes.Unit(-n,"%"));case"deg":return this.hsla.adjustHue(-n).rgba;default:return this.sub(n,n,n,0)}case"rgba":return this.sub(e.r,e.g,e.b,e.a);case"hsla":return this.hsla.sub(e.h,e.s,e.l)}break;case"*":switch(e.nodeName){case"unit":return this.multiply(e.val)}break;case"/":switch(e.nodeName){case"unit":return this.divide(e.val)}}return Node.prototype.operate.call(this,t,e)},RGBA.prototype.toString=function(){function t(t){return t<16?"0"+t.toString(16):t.toString(16)}if("transparent"==this.name)return this.name;if(1==this.a){var e=t(this.r),n=t(this.g),r=t(this.b);return e[0]==e[1]&&n[0]==n[1]&&r[0]==r[1]?"#"+e[0]+n[0]+r[0]:"#"+e+n+r}return"rgba("+this.r+","+this.g+","+this.b+","+ +this.a.toFixed(3)+")"},exports.fromHSLA=function(t){function e(t){return t<0&&++t,t>1&&--t,6*t<1?h+(a-h)*t*6:2*t<1?a:3*t<2?h+(a-h)*(2/3-t)*6:h}var n=t.h/360,r=t.s/100,i=t.l/100,s=t.a,a=i<=.5?i*(r+1):i+r-i*r,h=2*i-a,o=255*e(n+1/3),u=255*e(n),c=255*e(n-1/3);return new RGBA(o,u,c,s)};
