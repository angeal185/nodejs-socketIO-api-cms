function CoercionError(e){this.name="CoercionError",this.message=e,Error.captureStackTrace(this,CoercionError)}var Evaluator=require("../visitor/evaluator"),utils=require("../utils"),nodes=require("./");CoercionError.prototype.__proto__=Error.prototype;var Node=module.exports=function(){this.lineno=nodes.lineno||1,this.column=nodes.column||1,this.filename=nodes.filename};Node.prototype={constructor:Node,get first(){return this},get hash(){return this.val},get nodeName(){return this.constructor.name.toLowerCase()},clone:function(){return this},toJSON:function(){return{lineno:this.lineno,column:this.column,filename:this.filename}},eval:function(){return new Evaluator(this).evaluate()},toBoolean:function(){return nodes.true},toExpression:function(){if("expression"==this.nodeName)return this;var e=new nodes.Expression;return e.push(this),e},shouldCoerce:function(e){switch(e){case"is a":case"in":case"||":case"&&":return!1;default:return!0}},operate:function(e,o){switch(e){case"is a":if("string"==o.first.nodeName)return nodes.Boolean(this.nodeName==o.val);throw new Error('"is a" expects a string, got '+o.toString());case"==":return nodes.Boolean(this.hash==o.hash);case"!=":return nodes.Boolean(this.hash!=o.hash);case">=":return nodes.Boolean(this.hash>=o.hash);case"<=":return nodes.Boolean(this.hash<=o.hash);case">":return nodes.Boolean(this.hash>o.hash);case"<":return nodes.Boolean(this.hash<o.hash);case"||":return this.toBoolean().isTrue?this:o;case"in":var n=utils.unwrap(o).nodes,r=n&&n.length,t=this.hash;if(!n)throw new Error('"in" given invalid right-hand operand, expecting an expression');if(1==r&&"object"==n[0].nodeName)return nodes.Boolean(n[0].has(this.hash));for(var s=0;s<r;++s)if(t==n[s].hash)return nodes.true;return nodes.false;case"&&":var i=this.toBoolean(),a=o.toBoolean();return i.isTrue&&a.isTrue?o:i.isFalse?this:o;default:if("[]"==e)var h="cannot perform "+this+"["+o+"]";else var h="cannot perform "+this+" "+e+" "+o;throw new Error(h)}},coerce:function(e){if(e.nodeName==this.nodeName)return e;throw new CoercionError("cannot coerce "+e+" to "+this.nodeName)}};
