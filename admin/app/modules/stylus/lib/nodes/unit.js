var Node=require("./node"),nodes=require("./"),FACTOR_TABLE={mm:{val:1,label:"mm"},cm:{val:10,label:"mm"},in:{val:25.4,label:"mm"},pt:{val:25.4/72,label:"mm"},ms:{val:1,label:"ms"},s:{val:1e3,label:"ms"},Hz:{val:1,label:"Hz"},kHz:{val:1e3,label:"Hz"}},Unit=module.exports=function(e,t){Node.call(this),this.val=e,this.type=t};Unit.prototype.__proto__=Node.prototype,Unit.prototype.toBoolean=function(){return nodes.Boolean(!!this.type||this.val)},Unit.prototype.toString=function(){return this.val+(this.type||"")},Unit.prototype.clone=function(){var e=new Unit(this.val,this.type);return e.lineno=this.lineno,e.column=this.column,e.filename=this.filename,e},Unit.prototype.toJSON=function(){return{__type:"Unit",val:this.val,type:this.type,lineno:this.lineno,column:this.column,filename:this.filename}},Unit.prototype.operate=function(e,t){var n=this.type||t.first.type;if("rgba"==t.nodeName||"hsla"==t.nodeName)return t.operate(e,this);if(this.shouldCoerce(e))switch(t=t.first,t="%"==this.type||"-"!=e&&"+"!=e||"%"!=t.type?this.coerce(t):new Unit(this.val*(t.val/100),"%"),e){case"-":return new Unit(this.val-t.val,n);case"+":return n=n||"%"==t.type&&t.type,new Unit(this.val+t.val,n);case"/":return new Unit(this.val/t.val,n);case"*":return new Unit(this.val*t.val,n);case"%":return new Unit(this.val%t.val,n);case"**":return new Unit(Math.pow(this.val,t.val),n);case"..":case"...":var i=this.val,l=t.val,a=new nodes.Expression,o=".."==e;if(i<l)do{a.push(new nodes.Unit(i))}while(o?++i<=l:++i<l);else do{a.push(new nodes.Unit(i))}while(o?--i>=l:--i>l);return a}return Node.prototype.operate.call(this,e,t)},Unit.prototype.coerce=function(e){if("unit"==e.nodeName){var t=this,n=e,i=FACTOR_TABLE[t.type],l=FACTOR_TABLE[n.type];if(i&&l&&i.label==l.label){var a=n.val*(l.val/i.val);return new nodes.Unit(a,t.type)}return new nodes.Unit(n.val,t.type)}if("string"==e.nodeName){if("%"==e.val)return new nodes.Unit(0,"%");var o=parseFloat(e.val);return isNaN(o)&&Node.prototype.coerce.call(this,e),new nodes.Unit(o)}return Node.prototype.coerce.call(this,e)};
