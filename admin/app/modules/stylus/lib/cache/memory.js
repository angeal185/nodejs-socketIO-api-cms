var crypto=require("crypto"),nodes=require("../nodes"),MemoryCache=module.exports=function(e){e=e||{},this.limit=e["cache limit"]||256,this._cache={},this.length=0,this.head=this.tail=null};MemoryCache.prototype.set=function(e,t){var i,h=t.clone();h.filename=nodes.filename,h.lineno=nodes.lineno,h.column=nodes.column,i={key:e,value:h},this._cache[e]=i,this.tail?(this.tail.next=i,i.prev=this.tail):this.head=i,this.tail=i,this.length++==this.limit&&this.purge()},MemoryCache.prototype.get=function(e){var t=this._cache[e],i=t.value.clone();return t==this.tail?i:(t.next&&(t==this.head&&(this.head=t.next),t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t.next=null,t.prev=this.tail,this.tail&&(this.tail.next=t),this.tail=t,i)},MemoryCache.prototype.has=function(e){return!!this._cache[e]},MemoryCache.prototype.key=function(e,t){var i=crypto.createHash("sha1");return i.update(e+t.prefix),i.digest("hex")},MemoryCache.prototype.purge=function(){var e=this.head;this.head.next&&(this.head=this.head.next,this.head.prev=null),this._cache[e.key]=e.prev=e.next=null,this.length--};
