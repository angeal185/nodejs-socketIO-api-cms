var Compiler=require("../visitor/compiler"),nodes=require("../nodes"),parse=require("url").parse,relative=require("path").relative,join=require("path").join,dirname=require("path").dirname,extname=require("path").extname,sep=require("path").sep;module.exports=function(e){function r(r){var i=new Compiler(r),n=r.filename;i.isURL=!0,r=parse(r.nodes.map(function(e){return i.visit(e)}).join(""));var a,t=new nodes.Literal('url("'+r.href+'")'),s=r.pathname,o=this.options.dest,p="";if(r.protocol||!s||"/"==s[0])return t;if(!e.nocheck){var u=e.paths||[];if(!(s=require("../utils").lookup(s,u.concat(this.paths))))return t}return this.includeCSS&&".css"==extname(s)?new nodes.Literal(r.href):(r.search&&(p+=r.search),r.hash&&(p+=r.hash),o&&".css"==extname(o)&&(o=dirname(o)),a=relative(o||dirname(this.filename),e.nocheck?join(dirname(n),s):s)+p,"\\"==sep&&(a=a.replace(/\\/g,"/")),new nodes.Literal('url("'+a+'")'))}return e=e||{},r.options=e,r.raw=!0,r};
