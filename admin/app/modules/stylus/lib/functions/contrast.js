var utils=require("../utils"),nodes=require("../nodes"),blend=require("./blend"),luminosity=require("./luminosity");module.exports=function(e,n){function t(e,n){1>e.a&&(e=blend(e,n));var t=luminosity(n).val+.05,r=luminosity(e).val+.05,o=t/r;return r>t&&(o=1/o),Math.round(10*o)/10}function r(e,t){return Math.min(Math.max(0,(e-t*n.a)/(1-n.a)),255)}if("rgba"!=e.nodeName&&"hsla"!=e.nodeName)return new nodes.Literal("contrast("+(e.isNull?"":e.toString())+")");var o=new nodes.Object;if(e=e.rgba,n=n||new nodes.RGBA(255,255,255,1),utils.assertColor(n),n=n.rgba,1<=n.a){var s=new nodes.Unit(t(e,n));o.set("ratio",s),o.set("error",new nodes.Unit(0)),o.set("min",s),o.set("max",s)}else{var i=t(e,blend(n,new nodes.RGBA(0,0,0,1))),a=t(e,blend(n,new nodes.RGBA(255,255,255,1))),d=Math.max(i,a),u=new nodes.RGBA(r(e.r,n.r),r(e.g,n.g),r(e.b,n.b),1),l=t(e,blend(n,u));o.set("ratio",new nodes.Unit(Math.round(50*(l+d))/100)),o.set("error",new nodes.Unit(Math.round(50*(d-l))/100)),o.set("min",new nodes.Unit(l)),o.set("max",new nodes.Unit(d))}return o};
